<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedTrack | Chronic Care Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .progress-transition { transition: height 1s ease-in-out, background-color 0.5s; }
    </style>
    <!-- Google Maps API Script (Replace YOUR_API_KEY with your actual Google Maps API key) -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>
</head>
<body class="bg-slate-50 font-sans pb-20">
    <nav class="bg-blue-600 text-white p-4 shadow-lg sticky top-0 z-10">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-pills"></i> MedTrack
            </h1>
        <div id="statusBadge" class="bg-blue-700 px-3 py-1 rounded-full text-sm font-medium transition-colors">
            Next Dose: 6:00 PM
        </div>
        </div>
    </nav>
    <main class="max-w-4xl mx-auto p-4 space-y-6">
        <section class="bg-white rounded-2xl p-6 shadow-sm border-l-8 border-blue-500">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-gray-500 uppercase text-xs font-bold tracking-wider">Upcoming Medication</h2>
                        <button id="editBtn" class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <p id="medName" class="text-2xl font-bold text-gray-800">Metformin</p>
                    <p id="medDetails" class="text-gray-600">500mg • Take with food</p>
                </div>

                <div class="text-left md:text-right w-full md:w-auto">
                    <span id="medTime" class="block text-3xl font-mono font-bold text-blue-600 mb-2">18:00</span>
                    <button id="takeBtn" class="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl text-sm font-bold shadow-md transition-all active:scale-95">
                        Mark as Taken
                    </button>
                </div>
            </div>

            <!-- Edit Form (Hidden by default) -->
            <div id="editForm" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-bold text-gray-800 mb-3">Edit Medication</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Medication Name</label>
                        <input id="editName" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Metformin">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Dosage</label>
                        <input id="editDosage" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 500mg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Instructions</label>
                        <input id="editInstructions" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Take with food">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Time</label>
                        <input id="editTime" type="time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button id="cancelEdit" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">Cancel</button>
                    <button id="saveEdit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save</button>
                </div>
            </div>
        </section>

        <section>
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i class="fas fa-map-marker-alt text-red-500"></i> Nearby Stock
                </h3>
                <button onclick="checkMaps()" class="text-blue-600 text-sm font-semibold hover:underline">
                    View Full Map
                </button>
            </div>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-gray-700">City Health Pharmacy</span>
                        <span class="text-green-600 text-xs font-bold bg-green-100 px-2 py-1 rounded">In Stock</span>
                    </div>
                    <p class="text-sm text-gray-500">0.8 miles away • Open until 10 PM</p>
                    <button class="w-full mt-3 py-2 border border-blue-600 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-50 transition">
                        Reserve Refill
                    </button>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-gray-700">Walgreens Central</span>
                        <span class="text-orange-600 text-xs font-bold bg-orange-100 px-2 py-1 rounded">Low Stock</span>
                    </div>
                    <p class="text-sm text-gray-500">1.5 miles away • 24 Hours</p>
                    <button class="w-full mt-3 py-2 border border-gray-300 text-gray-400 rounded-lg text-sm font-medium cursor-not-allowed">
                        Call to Confirm
                    </button>
                </div>
            </div>
            <!-- Embedded Google Map for Nearby Pharmacies -->
            <div id="map" class="w-full h-64 rounded-xl shadow-sm border border-gray-100 mt-4"></div>
        </section>

        <section class="bg-white rounded-xl p-6 shadow-sm">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Weekly Adherence</h3>
            <div class="flex justify-between items-end h-24 gap-2 px-2">
                <div class="bg-blue-400 w-full rounded-t" style="height: 100%"></div>
                <div class="bg-blue-400 w-full rounded-t" style="height: 85%"></div>
                <div class="bg-blue-400 w-full rounded-t" style="height: 90%"></div>
                <div class="bg-blue-400 w-full rounded-t" style="height: 80%"></div>
                <div id="adherenceBar" class="bg-gray-200 w-full rounded-t progress-transition" style="height: 10%"></div>
                <div class="bg-gray-100 w-full rounded-t" style="height: 5%"></div>
                <div class="bg-gray-100 w-full rounded-t" style="height: 5%"></div>
            </div>
            <div class="flex justify-between mt-2 text-xs text-gray-400 font-medium px-2 text-center">
                <span class="w-full">Mon</span><span class="w-full">Tue</span><span class="w-full">Wed</span><span class="w-full">Thu</span><span class="w-full font-bold text-blue-600">Fri</span><span class="w-full">Sat</span><span class="w-full">Sun</span>
            </div>
        </section>
    </main>

    <div class="fixed bottom-0 w-full bg-white border-t border-gray-200 p-3 flex justify-around items-center md:hidden">
        <button class="text-blue-600 flex flex-col items-center"><i class="fas fa-home"></i><span class="text-[10px] mt-1">Home</span></button>
        <button class="text-gray-400 flex flex-col items-center"><i class="fas fa-search"></i><span class="text-[10px] mt-1">Stock</span></button>
        <button class="text-gray-400 flex flex-col items-center"><i class="fas fa-chart-line"></i><span class="text-[10px] mt-1">Stats</span></button>
        <button class="text-gray-400 flex flex-col items-center"><i class="fas fa-cog"></i><span class="text-[10px] mt-1">Settings</span></button>
    </div>

    <script>
        // --- Configuration & State ---
        let medName = "Metformin";
        let medDosage = "500mg";
        let medInstructions = "Take with food";
        let medTime = "18:00";

        const takeBtn = document.getElementById('takeBtn');
        const statusBadge = document.getElementById('statusBadge');
        const adherenceBar = document.getElementById('adherenceBar');
        const editBtn = document.getElementById('editBtn');
        const editForm = document.getElementById('editForm');
        const cancelEdit = document.getElementById('cancelEdit');
        const saveEdit = document.getElementById('saveEdit');
        const editName = document.getElementById('editName');
        const editDosage = document.getElementById('editDosage');
        const editInstructions = document.getElementById('editInstructions');
        const editTime = document.getElementById('editTime');
        const medNameDisplay = document.getElementById('medName');
        const medDetailsDisplay = document.getElementById('medDetails');
        const medTimeDisplay = document.getElementById('medTime');

        // --- Initialization ---
        function init() {
            // Load from localStorage
            medName = localStorage.getItem('medName') || medName;
            medDosage = localStorage.getItem('medDosage') || medDosage;
            medInstructions = localStorage.getItem('medInstructions') || medInstructions;
            medTime = localStorage.getItem('medTime') || medTime;
            updateDisplay();

            const today = new Date().toLocaleDateString();
            const lastTaken = localStorage.getItem('lastTakenDate');
            if (lastTaken === today) {
                updateUIAsTaken();
            }
        }

        function updateDisplay() {
            medNameDisplay.textContent = medName;
            medDetailsDisplay.textContent = `${medDosage} • ${medInstructions}`;
            medTimeDisplay.textContent = medTime;
            // Update status badge with new time
            const time12 = new Date(`1970-01-01T${medTime}:00`).toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true });
            statusBadge.textContent = `Next Dose: ${time12}`;
        }

        // --- Logic: Mark Medication as Taken ---
        function markAsTaken() {
            const today = new Date().toLocaleDateString();
            localStorage.setItem('lastTakenDate', today);
            updateUIAsTaken();
            sendNotification("Confirmed!", `You've recorded your ${medName} dose.`);
        }

        function updateUIAsTaken() {
            takeBtn.innerText = "Dose Recorded";
            takeBtn.disabled = true;
            takeBtn.classList.replace('bg-green-500', 'bg-gray-400');
            takeBtn.classList.replace('hover:bg-green-600', 'cursor-not-allowed');
            statusBadge.innerText = "All Doses Completed";
            statusBadge.classList.replace('bg-blue-700', 'bg-green-600');
            adherenceBar.style.height = "100%";
            adherenceBar.classList.replace('bg-gray-200', 'bg-blue-600');
        }

        // --- Edit Functionality ---
        editBtn.addEventListener('click', () => {
            editName.value = medName;
            editDosage.value = medDosage;
            editInstructions.value = medInstructions;
            editTime.value = medTime;
            editForm.classList.remove('hidden');
        });

        cancelEdit.addEventListener('click', () => {
            editForm.classList.add('hidden');
        });

        saveEdit.addEventListener('click', () => {
            medName = editName.value.trim() || medName;
            medDosage = editDosage.value.trim() || medDosage;
            medInstructions = editInstructions.value.trim() || medInstructions;
            medTime = editTime.value || medTime;
            localStorage.setItem('medName', medName);
            localStorage.setItem('medDosage', medDosage);
            localStorage.setItem('medInstructions', medInstructions);
            localStorage.setItem('medTime', medTime);
            updateDisplay();
            editForm.classList.add('hidden');
        });

        // --- Logic: Availability Checker (External Search) ---
        function checkMaps() {
            const query = encodeURIComponent(`${medName} pharmacy availability near me`);
            window.open(`https://www.google.com/maps/search/${query}`, '_blank');
        }

        // --- Google Maps Initialization ---
        function initMap() {
            const center = { lat: 40.7128, lng: -74.0060 };
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: center,
            });
            const pharmacy1 = new google.maps.Marker({
                position: { lat: 40.7128, lng: -74.0060 },
                map: map,
                title: 'City Health Pharmacy',
            });
            const pharmacy2 = new google.maps.Marker({
                position: { lat: 40.7138, lng: -74.0070 },
                map: map,
                title: 'Walgreens Central',
            });
        }

        // --- Notifications ---
        function sendNotification(title, body) {
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(title, { body, icon: 'https://cdn-icons-png.flaticon.com/512/822/822143.png' });
            }
        }

        // --- Event Listeners ---
        takeBtn.addEventListener('click', () => {
            if ("Notification" in window) {
                if (Notification.permission !== "granted") {
                    Notification.requestPermission().then(permission => {
                        if (permission === "granted") {
                            markAsTaken();
                        } else {
                            markAsTaken();
                        }
                    });
                } else {
                    markAsTaken();
                }
            } else {
                markAsTaken();
            }
        });

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
